"use strict";(self.webpackChunkconsumerportal_v2=self.webpackChunkconsumerportal_v2||[]).push([[169],{72169:function(e,t,r){r.r(t),r.d(t,{httpBackOfficeUtil:function(){return k}});var n,s,o,a,c,u,i,d,p,l=r(74165),f=r(15861),A=r(30863),h=r(42048),v=r(30456),k={setupChannel:function(e){return y.apply(this,arguments)},put:function(e){return E.apply(this,arguments)},post:T,get:function(e){return I.apply(this,arguments)},sendDelete:function(e){return K.apply(this,arguments)},is200OK:function(e){return!(!e||!e.status||"200"!=e.status)},startSession:w,getSession:function(){return console.log("AAAAAAAAAAAAAAAAAAAA"),console.log("AAAAAAAAAAAAAAAAAAAA"),console.log("AAAAAAAAAAAAAAAAAAAA"),console.log("AAAAAAAAAAAAAAAAAAAA _sessionData:",p),p},cleanObj:q,cleanSession:O,switchSession:function(e,t){var r=e.access_token,s=e.refresh_token,o=e.exp;if(p=v(r),t){var a=v(u);n("merchant_id",p.current_organisation_id),n("service_owner_id",a.current_organisation_id)}else n("merchant_id",null);w({access_token:r,refresh_token:s,exp:o})}},x="self-service",b="backoffice/v1/";function y(){return(y=(0,f.Z)((0,l.Z)().mark((function e(t){var r,f,A,h,k,x;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storeKVFn,f=t.getKVFn,A=t.sessionInvalidCallback,h=t.apiKey,k=t.host,x=t.fetchFn,n=r,s=f,o=A,c=h,d=k,a=x||fetch,!s){e.next=25;break}return e.next=10,s("access_token");case 10:return u=e.sent,e.next=13,s("refresh_token");case 13:if(i=e.sent,e.prev=14,!u){e.next=19;break}return p=v(u),e.next=19,g();case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(14),console.log("Failed to load session data: ",e.t0),p=void 0;case 25:case"end":return e.stop()}}),e,null,[[14,21]])})))).apply(this,arguments)}function g(){return _.apply(this,arguments)}function _(){return(_=(0,f.Z)((0,l.Z)().mark((function e(){var t,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=Date.now(),!(p.exp-t/1e3>3600)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,T({resourcePath:"users/refresh",refreshToken:!0,logOutIfSessionInvalid:!1});case 7:if("OK"!=(r=e.sent).code){e.next=11;break}return w(r.data),e.abrupt("return");case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.log("Exception refresh: ",e.t0),e.abrupt("return");case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function w(e){var t=e.access_token,r=e.refresh_token;e.exp,e.organisations;u=t,i=r,n&&(n("refresh_token",r),n("access_token",t),p=v(u))}function O(){u=void 0,i=void 0,n&&(n("refresh_token",void 0),n("access_token",void 0),console.log("Session cleared"))}function Z(e,t){return 1==e?d+b+t:d+x+t}function m(e){try{return JSON.parse(e)}catch(t){return null}}function T(e){return S.apply(this,arguments)}function S(){return S=(0,f.Z)((0,l.Z)().mark((function e(t){var r,n,s,o,p,f,v,k,x,b,y,g,_,w;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resourcePath,n=t.body,s=t.queryParams,o=t.withAccessToken,p=void 0!==o&&o,f=t.withoutApikey,v=void 0!==f&&f,k=t.logOutIfSessionInvalid,x=void 0===k||k,b=t.refreshToken,y=d+"backoffice/v1/"+r,(g={}).headers=(0,h.initOptionHeader)(),g.method="POST",1==p||1==x||1==b?g.headers.Authorization=b?"Bearer "+i:"Bearer "+u:v||(g.headers.api_key=c),n&&(g.body=JSON.stringify(n)),s&&(y=d+"?"+A.encode(s)),console.log("POST: ",y,g),e.next=11,a(y,g);case 11:return _=e.sent,e.next=14,_.text();case 14:if(w=e.sent,console.log("Response - ",_.status," - Body:",w?m(w):w),"200"!=_.status){e.next=20;break}return e.abrupt("return",{code:"OK",data:w?m(w):null});case 20:return B(_,x),e.abrupt("return",{code:_.status,bodyText:w,error:m(w)});case 22:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function B(e,t){return P.apply(this,arguments)}function P(){return(P=(0,f.Z)((0,l.Z)().mark((function e(t,r){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,1!=r||!o||"401"!=t.status){e.next=5;break}return e.next=4,o();case 4:O();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function I(){return(I=(0,f.Z)((0,l.Z)().mark((function e(t){var r,n,s,o,i,d,p,f,v,k,x,b,y,g;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resourcePath,n=t.queryParams,s=t.withAccessToken,o=void 0!==s&&s,i=t.isBackend,d=void 0===i||i,p=t.logOutIfSessionInvalid,f=void 0===p||p,v=t.returnText,k=void 0!==v&&v,x=Z(d,r),(b={}).headers=(0,h.initOptionHeader)(),b.method="GET",1==o||1==f?b.headers.Authorization="Bearer "+u:b.headers.api_key=c,n&&(x=x+"?"+A.encode(q(n))),console.log("GET: ",x,b),e.next=10,a(x,b);case 10:return y=e.sent,e.next=13,y.text();case 13:if(g=e.sent,console.log("Response - ",y.status," - Body:",g?m(g):g),"200"!=y.status){e.next=21;break}if(!k){e.next=18;break}return e.abrupt("return",{code:"OK",data:g});case 18:return e.abrupt("return",{code:"OK",data:g?m(g):null});case 21:return B(y,f),e.abrupt("return",{code:y.status,bodyText:g,error:m(g)});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return(K=(0,f.Z)((0,l.Z)().mark((function e(t){var r,n,s,o,i,p,f,v,k,x,b;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resourcePath,n=t.queryParams,s=t.withAccessToken,o=void 0!==s&&s,i=t.isBackend,void 0!==i&&i,p=t.logOutIfSessionInvalid,f=void 0===p||p,v=d+"backoffice/v1/"+r,(k={}).headers=(0,h.initOptionHeader)(),k.method="DELETE",1==o||1==f?k.headers.Authorization="Bearer "+u:k.headers.api_key=c,n&&(v=v+"?"+A.encode(q(n))),console.log("GET: ",v,k),e.next=10,a(v,k);case 10:return x=e.sent,e.next=13,x.text();case 13:if(b=e.sent,console.log("Response - ",x.status," - Body:",b?m(b):b),"200"!=x.status){e.next=19;break}return e.abrupt("return",{code:"OK",data:b?m(b):null});case 19:return B(x,f),e.abrupt("return",{code:x.status,bodyText:b,error:m(b)});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){return(E=(0,f.Z)((0,l.Z)().mark((function e(t){var r,n,s,o,i,p,f,v,k,x,b,y;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.resourcePath,n=t.body,s=t.queryParams,o=t.withAccessToken,i=void 0!==o&&o,p=t.isBackend,void 0!==p&&p,f=t.logOutIfSessionInvalid,v=void 0===f||f,k=d+"backoffice/v1/"+r,(x={}).headers=(0,h.initOptionHeader)(),x.method="PUT",1==i||1==v?x.headers.Authorization="Bearer "+u:x.headers.api_key=c,n&&(x.body=JSON.stringify(n)),s&&(k=k+"?"+A.encode(s)),console.log("PUT: ",k,x),e.next=11,a(k,x);case 11:return b=e.sent,e.next=14,b.text();case 14:if(y=e.sent,console.log("Response - ",b.status," - Body:",y?m(y):y),"200"!=b.status){e.next=20;break}return e.abrupt("return",{code:"OK",data:y?m(y):null});case 20:return B(b,v),e.abrupt("return",{code:b.status,bodyText:y,error:m(y)});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){for(var t in e)null!==e[t]&&void 0!==e[t]||delete e[t];return e}}}]);
//# sourceMappingURL=169.5d6f1ad4.chunk.js.map