"use strict";(self.webpackChunkconsumerportal_v2=self.webpackChunkconsumerportal_v2||[]).push([[719],{38719:function(e,s,r){r.r(s),r.d(s,{default:function(){return A}});var t=r(74165),n=r(15861),o=r(29439),c=r(72791),a=r(1288),i=r(79941),d=r(81289),l=r(30681),u=r(62398),m=r(57689),p=r(33098),g=r(20890),f=r(95216),h=r(88951),_=r(39230),x=r(80184);function A(e){var s=(0,_.$G)().t,r=(0,m.s0)(),A=(0,c.useState)(!0),C=(0,o.Z)(A,2),E=C[0],v=C[1],Z=(0,c.useState)(!0),S=(0,o.Z)(Z,2),j=S[0],I=S[1],k=(0,c.useState)(null),P=(0,o.Z)(k,2),R=P[0],D=P[1],T=(0,c.useState)(null),w=(0,o.Z)(T,2),M=w[0],b=w[1],L=h.cacheCustom.getPaymentData();(0,c.useEffect)((function(){O()}),[]);var O=function(){var e=(0,n.Z)((0,t.Z)().mark((function e(){var s,r,n,o,c,a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new URL(window.location.href),console.log("url===",s),r=s.searchParams.get("ID"),n=s.searchParams.get("RespCode"),o=s.searchParams.get("ReasonCode"),c={nonce:r,name:"FAC",respCode:n,reasonCode:o},a=y(n,o),console.log("resultMapping:",a.success),!a||!a.success){e.next=21;break}if(I(!0),!L||"PAYMENT"!=L.type){e.next=15;break}return e.next=13,X({token:c.nonce,amount:L.amount});case 13:e.next=18;break;case 15:if(!L||"ADD_CARD"!=L.type){e.next=18;break}return e.next=18,F(c);case 18:D({success:!0}),e.next=23;break;case 21:I(!0),D(a);case 23:v(!1);case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=(0,n.Z)((0,t.Z)().mark((function e(n){var o,c;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("payload:",n),o=document._portalConfig.facIntegration,console.log("facIntegration1:",o),e.next=5,u.default.payment.addPaymentMethod({name:n.name,integration_id:o,gateway_token:n.nonce,payment_method_type:"CARD",gateway:null},{});case 5:c=e.sent,console.log("createCustomerResult ===",c),"OK"===c.code?b({success:!0,message:"CRM Add Payment method successfully"}):"CUSTOMER_EMAIL_ALREADY_EXIST"===c.code?b({success:!1,message:"Add card failed",respCode:c.code,description:c.data&&c.data.error&&c.data.error.message?c.data.error.message:s("CUSTOMER_EMAIL_ALREADY_EXIST")}):b({success:!1,message:"Add card failed",respCode:c.data&&c.data.code?c.data.code:"",description:c.data&&c.data.error&&c.data.error.message?c.data.error.message:s("EXCEPTION_PROCESS")}),L&&"make_payment"==L.from&&setTimeout((function(){r(p.config_path.home,{state:{target:"make_payment"}})}),1e3);case 9:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),X=function(){var e=(0,n.Z)((0,t.Z)().mark((function e(r){var n,o;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r.entity_id&&n.push(r.entity_id),e.next=4,f.payment.createPayment({amount:r.amount,transaction_id:r.token,financial_transactions_payable:n});case 4:o=e.sent,console.log("create payment on crm5 ===",o),h.cacheCustom.setPaymentData(null),"OK"===o.code?b({success:!0,message:s("CREATE_PAYMENT_SUCCESS")}):"CUSTOMER_EMAIL_ALREADY_EXIST"===o.code?b({success:!0,message:s("CUSTOMER_EMAIL_ALREADY_EXIST")}):b({success:!1,message:s("CREATE_PAYMENT_FAILED")});case 8:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();return console.log("AAAA facResult:",R),console.log("AAAA crmResult:",M),console.log("AAAA ready:",j),j?(0,x.jsx)(l.default,{showProcessing:E,children:(0,x.jsxs)(a.Z,{xs:12,item:!0,children:[(0,x.jsxs)(a.Z,{xs:12,item:!0,justify:"center",container:!0,children:[R&&R.success&&M&&M.success&&(0,x.jsx)(d.SuccessIcon,{size:100,color:"green"}),(R&&!R.success||M&&!M.success)&&(0,x.jsx)(d.ErrorIcon,{size:100,color:"red"})]}),(0,x.jsx)(a.Z,{xs:12,item:!0,justify:"center",container:!0,children:R&&(0,x.jsxs)(a.Z,{item:!0,xs:12,style:{textAlign:"center"},children:[R.message&&(0,x.jsx)(g.Z,{color:R.success?"success":"error",variant:"h5",mg_top_xl:!0,children:R.message}),R.description&&(0,x.jsx)(g.Z,{color:R.success?"success":"error",variant:"h5",mg_top_md:!0,children:R.description}),R.note&&(0,x.jsx)(g.Z,{color:R.success?"success":"error",variant:"h5",mg_top_md:!0,children:R.note}),R.respCode&&R.reasonCode&&(0,x.jsxs)(g.Z,{color:R.success?"success":"error",variant:"h5",mg_top_md:!0,children:["Error: FAC "," ",R.reasonCode]})]})}),(0,x.jsx)(a.Z,{xs:12,item:!0,justify:"center",container:!0,children:M&&(0,x.jsxs)(a.Z,{item:!0,xs:12,style:{textAlign:"center"},children:[(0,x.jsx)(g.Z,{bold:!0,color:M.success?"green":"red",variant:"h5",mg_top_xl:!0,children:M.message?M.message:""}),(0,x.jsx)(g.Z,{bold:!0,color:M.success?"green":"red",variant:"h5",mg_top_xl:!0,children:M.description?M.description:""}),M.respCode&&(0,x.jsxs)(g.Z,{color:M.success?"success":"error",variant:"h5",mg_top_md:!0,children:["Error: CRM "," ",M.respCode]})]})}),(0,x.jsx)(a.Z,{item:!0,xs:12,justify:"center",container:!0,style:{marginTop:20},children:(0,x.jsx)(i.Z,{variant:"contained",onClick:function(){return r(p.config_path.home)},color:"primary",children:"Back to Home"})})]})}):(0,x.jsx)(l.default,{showProcessing:E})}function y(e,s){var r={respCode:e,reasonCode:s,success:!1,description:"",note:"",message:""};if("1"===e&&"1"===s)r={respCode:e,reasonCode:s,description:"Normal Approval",success:!0,message:"Add card successfully."};else if("EX01"==s)r.message="Add card failed.";else if("EX02"==s)r.message="Payment failed.";else{r.message="Transaction is declined.";var t=s.split("-");if(t&&t.length>0){var n=t[0],o=1==t.length?t.length[1]:"";"FC3"==n||"34"==n?(r.description="Fraud check error.",r.note="Fraud check error."):"03"==n?(r.description="Invalid Merchant.",r.note="Not such merchant."):"05"==n?(r.description="Transaction is declined.",r.note="Default decline."):"12"==n?"315"==o?(r.description="Invalid card/currency",r.note=""):"321"==o?(r.description="Processing errors",r.note=""):"387"==o?(r.description="Duplicate transaction.",r.note="Duplicate TransactionIdentifier."):"370"==o?(r.description="Transaction mismatch.",r.note="Simulator transaction mismatch."):"546"==o?(r.description="3DS1 error.",r.note="3DS1 fallback not allowed."):"75"==o?(r.description="SPI error.",r.note=""):"758"==o?(r.description="HPP error.",r.note="Invalid HPP page."):(r.description="Invalid transaction.",r.note=""):"3D3"==n?["519","618","518","520"].includes(o)?(r.description="3DS1 system error.",r.note=""):["611","511","532","548","549","510"].includes(o)?(r.description="3DS system error.",r.note=""):(r.description="3DS2 system error.",r.note=""):"57"==n?(r.description="Invalid card type.",r.note=""):"89"==n?(r.description="Failed authentication.",r.note="Invalid credentials."):"91"==n?(r.description="Host timeout or error",r.note=""):"96"==n?(r.description="Host processing or system error.",r.note=""):"97"==n?(r.description="Request failed validation.",r.note=""):(r.description="General error.",r.note="")}else r.description="System error.",r.note=""}return r}}}]);
//# sourceMappingURL=719.875a4753.chunk.js.map